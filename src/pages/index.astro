---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/blog/BlogCard.astro';
import ProductCard from '../components/product/ProductCard.astro';
import { getCollection } from 'astro:content';
import siteConfig from '../data/site-config.json';
import categories from '../data/categories.json';
import { buildAmazonLink } from '../utils/affiliate';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 6);

const allProducts = await getCollection('products');
// 8 coups de c≈ìur pour la homepage
const featuredProducts = allProducts
  .filter((p) => p.data.featured)
  .sort((a, b) => b.data.rating.score - a.data.rating.score)
  .slice(0, 8);

// Top 4 produits les mieux not√©s (avec beaucoup d'avis) pour le trending
const trendingProducts = allProducts
  .filter((p) => p.data.rating.count > 3000)
  .sort((a, b) => (b.data.rating.score * Math.log(b.data.rating.count)) - (a.data.rating.score * Math.log(a.data.rating.count)))
  .slice(0, 4);
---

<BaseLayout
  title="Accueil"
  description={siteConfig.siteDescription}
>
  <!-- Hero Section - Optimis√© conversion -->
  <section class="relative bg-gradient-to-br from-primary-50 via-warm-50 to-accent-50 py-16 md:py-24 overflow-hidden">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto text-center">
        <!-- Badge social proof -->
        <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full shadow-sm mb-6">
          <span class="flex h-2 w-2 relative">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
          </span>
          <span class="text-sm text-gray-600 font-medium">Les produits les plus populaires de 2025</span>
        </div>

        <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 leading-tight mb-6">
          D√©corez votre maison
          <span class="text-primary-600"> sans vous ruiner</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-600 mb-8 max-w-2xl mx-auto leading-relaxed">
          Salut, je suis Issam. Je teste les produits d√©co Amazon pour vous, et je vous dis honn√™tement lesquels valent vraiment le coup. Que des avis vrais, aucun bullshit.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/produits/" class="btn-primary text-lg px-8 py-4">
            üî• Voir les best-sellers
          </a>
          <a href="/blog/" class="inline-flex items-center justify-center px-6 py-3 bg-white text-gray-700 font-semibold rounded-lg border border-gray-200 hover:border-primary-300 hover:text-primary-600 transition-all duration-200 shadow-sm">
            Lire nos guides
          </a>
        </div>

        <!-- Trust badges -->
        <div class="flex flex-wrap items-center justify-center gap-4 mt-8 text-sm">
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>‚úÖ</span><span class="text-gray-700 font-medium">Produits test√©s</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>üì¶</span><span class="text-gray-700 font-medium">Livraison Amazon rapide</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>‚≠ê</span><span class="text-gray-700 font-medium">Min. 4 √©toiles</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>üí∞</span><span class="text-gray-700 font-medium">Petit budget</span>
          </div>
        </div>
      </div>
    </div>
    <div class="absolute top-10 left-10 text-6xl opacity-10">üè†</div>
    <div class="absolute bottom-10 right-10 text-6xl opacity-10">üõãÔ∏è</div>
  </section>

  <!-- üî• TRENDING Section ‚Äî produits r√©els dynamiques -->
  <section class="py-12 bg-gradient-to-r from-gray-900 to-gray-800">
    <div class="container-custom">
      <div class="text-center mb-8">
        <span class="inline-flex items-center gap-2 bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-sm font-bold mb-3">
          üî• LES PLUS POPULAIRES
        </span>
        <h2 class="font-serif text-3xl font-bold text-white">
          Top produits en ce moment
        </h2>
        <p class="text-gray-400 mt-2 text-sm">Les mieux not√©s par des milliers d'acheteurs sur Amazon.fr</p>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {trendingProducts.map((product) => (
          <a
            href={buildAmazonLink(product.data.amazonAsin, product.data.affiliateTag)}
            target="_blank"
            rel="nofollow sponsored noopener"
            class="bg-gray-800/50 border border-gray-700 rounded-xl p-4 hover:border-primary-400 transition-all duration-300 hover:scale-[1.02] group block"
          >
            <!-- Image produit r√©elle -->
            <div class="aspect-square bg-white/5 rounded-lg flex items-center justify-center p-3 mb-3 overflow-hidden">
              <img
                src={product.data.image}
                alt={product.data.name}
                class="max-w-full max-h-full object-contain group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
            </div>
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-bold px-2 py-0.5 rounded-full bg-primary-500/20 text-primary-400 capitalize">{product.data.category}</span>
              <span class="text-xs text-amber-400 font-semibold">‚≠ê {product.data.rating.score}/5</span>
            </div>
            <h3 class="font-bold text-white group-hover:text-primary-400 transition-colors text-sm leading-snug mb-2 line-clamp-2">{product.data.name}</h3>
            <div class="flex items-center justify-between mb-3">
              <span class="text-xl font-bold text-amber-400">{product.data.price.current.toFixed(2)} ‚Ç¨</span>
              <span class="text-xs text-gray-500">{product.data.rating.count.toLocaleString('fr-FR')} avis</span>
            </div>
            <div class="text-center py-2 rounded-lg font-bold text-sm transition-all duration-200 group-hover:shadow-lg"
              style="background: linear-gradient(135deg, #FF9900 0%, #FF6B00 100%); color: #111;">
              Voir le prix ‚Üí
            </div>
          </a>
        ))}
      </div>
      <div class="text-center mt-6">
        <a href="/produits/" class="inline-flex items-center gap-2 text-gray-300 hover:text-white text-sm font-medium transition-colors">
          Voir tous les produits
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Categories ‚Äî lien vers les produits filtr√©s -->
  <section class="py-16">
    <div class="container-custom">
      <h2 class="font-serif text-3xl font-bold text-gray-900 text-center mb-3">
        Explorez par cat√©gorie
      </h2>
      <p class="text-gray-500 text-center mb-10 text-sm">Trouvez facilement les produits qu'il vous faut</p>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        {categories.map((cat) => (
          <a
            href={`/produits/`}
            data-filter={cat.slug}
            class="card p-6 text-center hover:border-primary-300 hover:shadow-md group transition-all duration-200"
          >
            <span class="text-4xl mb-3 block group-hover:scale-110 transition-transform duration-200">{cat.emoji}</span>
            <h3 class="font-semibold text-gray-900 group-hover:text-primary-600 transition-colors">{cat.name}</h3>
            <p class="text-xs text-gray-500 mt-1">{cat.description}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Products -->
  {featuredProducts.length > 0 && (
    <section class="py-16 bg-white">
      <div class="container-custom">
        <div class="flex items-center justify-between mb-10">
          <div>
            <h2 class="font-serif text-3xl font-bold text-gray-900">
              ‚≠ê Mes coups de c≈ìur
            </h2>
            <p class="text-gray-500 mt-1 text-sm">Produits que j'ai gard√©s apr√®s test ‚Äî recommand√©s √† 100%</p>
          </div>
          <a href="/produits/" class="text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1 whitespace-nowrap">
            Tout voir ({allProducts.length})
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          {featuredProducts.map((product) => (
            <ProductCard
              name={product.data.name}
              slug={product.data.slug}
              shortDescription={product.data.shortDescription}
              image={product.data.image}
              category={product.data.category}
              amazonAsin={product.data.amazonAsin}
              affiliateTag={product.data.affiliateTag}
              price={product.data.price}
              rating={product.data.rating}
              featured={product.data.featured}
              inStock={product.data.inStock}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Recent Blog Posts -->
  {recentPosts.length > 0 && (
    <section class="py-16">
      <div class="container-custom">
        <div class="flex items-center justify-between mb-10">
          <div>
            <h2 class="font-serif text-3xl font-bold text-gray-900">
              üìù Derniers guides
            </h2>
            <p class="text-gray-500 mt-1 text-sm">Conseils pratiques pour d√©corer intelligemment</p>
          </div>
          <a href="/blog/" class="text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1 whitespace-nowrap">
            Tous les articles
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recentPosts.map((post) => (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              cover={post.data.cover}
              coverAlt={post.data.coverAlt}
              category={post.data.category}
              type={post.data.type}
              pubDate={post.data.pubDate}
              slug={post.id}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Ebook CTA Banner -->
  <section class="py-12 bg-gradient-to-r from-purple-600 to-indigo-700">
    <div class="container-custom">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="text-center md:text-left">
          <span class="text-4xl mb-2 block">üìö</span>
          <h2 class="font-serif text-2xl md:text-3xl font-bold text-white mb-2">
            Ebook : 50 Astuces D√©co Petit Budget
          </h2>
          <p class="text-purple-200">Transformez votre int√©rieur pour moins de 50 ‚Ç¨ par pi√®ce</p>
        </div>
        <div class="text-center">
          <div class="mb-2">
            <span class="text-sm text-purple-300 line-through">19,99 ‚Ç¨</span>
            <span class="text-3xl font-bold text-white ml-2">9,99 ‚Ç¨</span>
          </div>
          <a href="/ebooks/" class="inline-flex items-center justify-center px-8 py-3 bg-white text-purple-700 font-bold rounded-lg hover:bg-gray-100 transition-colors shadow-lg">
            D√©couvrir ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section Social -->
  <section class="py-16 bg-gradient-to-r from-primary-500 to-primary-700">
    <div class="container-custom text-center">
      <h2 class="font-serif text-3xl md:text-4xl font-bold text-white mb-4">
        On se suit sur les r√©seaux ?
      </h2>
      <p class="text-primary-100 text-lg mb-8 max-w-2xl mx-auto">
        Je partage mes bons plans, hauls Amazon et astuces d√©co en vid√©o. Rejoins la communaut√© pour ne rien rater !
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href={siteConfig.social.tiktok} target="_blank" rel="noopener" class="inline-flex items-center justify-center px-6 py-3 bg-white text-gray-900 font-bold rounded-lg hover:bg-gray-100 transition-colors gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.27 6.27 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.75a8.18 8.18 0 004.76 1.52V6.84a4.83 4.83 0 01-1-.15z"/></svg>
          TikTok
        </a>
        <a href={siteConfig.social.youtube} target="_blank" rel="noopener" class="inline-flex items-center justify-center px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
          YouTube
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
