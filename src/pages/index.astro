---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/blog/BlogCard.astro';
import ProductCard from '../components/product/ProductCard.astro';
import { getCollection } from 'astro:content';
import siteConfig from '../data/site-config.json';
import categories from '../data/categories.json';
import { buildAmazonLink } from '../utils/affiliate';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 6);

const allProducts = await getCollection('products');
const featuredProducts = allProducts
  .filter((p) => p.data.featured)
  .slice(0, 4);

const trendingProducts = [
  { name: "Lampe Sunset TikTok", emoji: "ğŸŒ…", price: "15", asin: "B09XJ75QK8", tag: "Viral TikTok", sales: "50K+" },
  { name: "Bande LED Govee 5m", emoji: "ğŸŒˆ", price: "16", asin: "B07XT8J3HZ", tag: "Best-seller", sales: "100K+" },
  { name: "Projecteur Galaxie POCOCO", emoji: "ğŸŒŒ", price: "30", asin: "B0B79LJYFN", tag: "Nouveau", sales: "35K+" },
  { name: "Neon LED Personnalisable", emoji: "ğŸ’œ", price: "36", asin: "B095BZQHFP", tag: "Tendance", sales: "20K+" },
];
---

<BaseLayout
  title="Accueil"
  description={siteConfig.siteDescription}
>
  <!-- Hero Section - OptimisÃ© conversion -->
  <section class="relative bg-gradient-to-br from-primary-50 via-warm-50 to-accent-50 py-16 md:py-24 overflow-hidden">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto text-center">
        <!-- Badge social proof -->
        <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full shadow-sm mb-6">
          <span class="flex h-2 w-2 relative">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
          </span>
          <span class="text-sm text-gray-600 font-medium">Les produits les plus populaires de 2025</span>
        </div>

        <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 leading-tight mb-6">
          Transformez votre interieur
          <span class="text-primary-600"> sans vous ruiner</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
          Guides d'achat, comparatifs et avis honnetes. Decouvrez les meilleurs produits deco Amazon testes et approuves.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/produits/" class="btn-primary text-lg px-8 py-4">
            ğŸ”¥ Voir les best-sellers
          </a>
          <a href="/blog/" class="inline-flex items-center justify-center px-6 py-3 bg-white text-gray-700 font-semibold rounded-lg border border-gray-200 hover:border-primary-300 hover:text-primary-600 transition-all duration-200 shadow-sm">
            Lire nos guides
          </a>
        </div>

        <!-- Trust badges -->
        <div class="flex flex-wrap items-center justify-center gap-6 mt-8 text-sm text-gray-500">
          <span class="flex items-center gap-1">âœ… Produits testes</span>
          <span class="flex items-center gap-1">ğŸ“¦ Livraison Amazon</span>
          <span class="flex items-center gap-1">â­ 4+ etoiles</span>
          <span class="flex items-center gap-1">ğŸ’° Petit budget</span>
        </div>
      </div>
    </div>
    <div class="absolute top-10 left-10 text-6xl opacity-10">ğŸ </div>
    <div class="absolute bottom-10 right-10 text-6xl opacity-10">ğŸ›‹ï¸</div>
  </section>

  <!-- ğŸ”¥ TRENDING TIKTOK Section - Le plus important pour la conversion -->
  <section class="py-12 bg-gradient-to-r from-gray-900 to-gray-800">
    <div class="container-custom">
      <div class="text-center mb-8">
        <span class="inline-flex items-center gap-2 bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-sm font-bold mb-3">
          ğŸ”¥ TRENDING
        </span>
        <h2 class="font-serif text-3xl font-bold text-white">
          Les plus vendus sur TikTok & Amazon
        </h2>
        <p class="text-gray-400 mt-2">Produits viraux testes et approuves par notre equipe</p>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {trendingProducts.map((product) => (
          <a
            href={buildAmazonLink(product.asin)}
            target="_blank"
            rel="nofollow sponsored noopener"
            class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 hover:border-primary-500 transition-all duration-300 hover:scale-[1.02] group block"
          >
            <div class="flex items-center justify-between mb-3">
              <span class="text-3xl">{product.emoji}</span>
              <span class="text-xs font-bold px-2 py-1 rounded-full bg-primary-500/20 text-primary-400">{product.tag}</span>
            </div>
            <h3 class="font-bold text-white group-hover:text-primary-400 transition-colors mb-1">{product.name}</h3>
            <div class="flex items-center justify-between mt-3">
              <span class="text-2xl font-bold text-primary-400">{product.price} EUR</span>
              <span class="text-xs text-gray-500">{product.sales} vendus</span>
            </div>
            <div class="mt-3 text-center bg-amber-400 text-gray-900 py-2 rounded-lg font-bold text-sm group-hover:bg-amber-300 transition-colors">
              Voir sur Amazon â†’
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Categories -->
  <section class="py-16">
    <div class="container-custom">
      <h2 class="font-serif text-3xl font-bold text-gray-900 text-center mb-10">
        Explorez par categorie
      </h2>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        {categories.map((cat) => (
          <a
            href={`/blog/categorie/${cat.slug}/`}
            class="card p-6 text-center hover:border-primary-200 group"
          >
            <span class="text-4xl mb-3 block">{cat.emoji}</span>
            <h3 class="font-semibold text-gray-900 group-hover:text-primary-600 transition-colors">{cat.name}</h3>
            <p class="text-xs text-gray-500 mt-1">{cat.description}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Products -->
  {featuredProducts.length > 0 && (
    <section class="py-16 bg-white">
      <div class="container-custom">
        <div class="flex items-center justify-between mb-10">
          <h2 class="font-serif text-3xl font-bold text-gray-900">
            â­ Nos coups de coeur
          </h2>
          <a href="/produits/" class="text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1">
            Tous les produits
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          {featuredProducts.map((product) => (
            <ProductCard
              name={product.data.name}
              slug={product.data.slug}
              shortDescription={product.data.shortDescription}
              image={product.data.image}
              category={product.data.category}
              price={product.data.price}
              rating={product.data.rating}
              featured={product.data.featured}
              inStock={product.data.inStock}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Recent Blog Posts -->
  {recentPosts.length > 0 && (
    <section class="py-16">
      <div class="container-custom">
        <div class="flex items-center justify-between mb-10">
          <h2 class="font-serif text-3xl font-bold text-gray-900">
            ğŸ“ Derniers articles
          </h2>
          <a href="/blog/" class="text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1">
            Tous les articles
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recentPosts.map((post) => (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              cover={post.data.cover}
              coverAlt={post.data.coverAlt}
              category={post.data.category}
              type={post.data.type}
              pubDate={post.data.pubDate}
              slug={post.id}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Ebook CTA Banner -->
  <section class="py-12 bg-gradient-to-r from-purple-600 to-indigo-700">
    <div class="container-custom">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="text-center md:text-left">
          <span class="text-4xl mb-2 block">ğŸ“š</span>
          <h2 class="font-serif text-2xl md:text-3xl font-bold text-white mb-2">
            Ebook : 50 Astuces Deco Petit Budget
          </h2>
          <p class="text-purple-200">Transformez votre interieur pour moins de 50 EUR par piece</p>
        </div>
        <div class="text-center">
          <div class="mb-2">
            <span class="text-sm text-purple-300 line-through">19.99 EUR</span>
            <span class="text-3xl font-bold text-white ml-2">9.99 EUR</span>
          </div>
          <a href="/ebooks/" class="inline-flex items-center justify-center px-8 py-3 bg-white text-purple-700 font-bold rounded-lg hover:bg-gray-100 transition-colors shadow-lg">
            Decouvrir â†’
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section Social -->
  <section class="py-16 bg-gradient-to-r from-primary-500 to-primary-700">
    <div class="container-custom text-center">
      <h2 class="font-serif text-3xl md:text-4xl font-bold text-white mb-4">
        Suivez-moi sur les reseaux
      </h2>
      <p class="text-primary-100 text-lg mb-8 max-w-2xl mx-auto">
        Decouvrez mes bons plans, astuces deco et tests de produits en video sur TikTok et YouTube !
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href={siteConfig.social.tiktok} target="_blank" rel="noopener" class="inline-flex items-center justify-center px-6 py-3 bg-white text-gray-900 font-bold rounded-lg hover:bg-gray-100 transition-colors gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.27 6.27 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.75a8.18 8.18 0 004.76 1.52V6.84a4.83 4.83 0 01-1-.15z"/></svg>
          TikTok
        </a>
        <a href={siteConfig.social.youtube} target="_blank" rel="noopener" class="inline-flex items-center justify-center px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
          YouTube
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
