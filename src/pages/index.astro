---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/blog/BlogCard.astro';
import ProductCard from '../components/product/ProductCard.astro';
import { getCollection } from 'astro:content';
import siteConfig from '../data/site-config.json';
import categories from '../data/categories.json';
import { buildAmazonLink } from '../utils/affiliate';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 6);

const allProducts = await getCollection('products');
const featuredProducts = allProducts
  .filter((p) => p.data.featured)
  .slice(0, 4);

const trendingProducts = [
  { name: "Lampe Sunset Projection", emoji: "üåÖ", price: "19,99", asin: "B09XJ75QK8", tag: "Viral TikTok", sales: "50K+", slug: "lampe-sunset-projection" },
  { name: "Miroir Soleil Dor√© 60cm", emoji: "ü™û", price: "49,99", asin: "B08L5VXYZ7", tag: "Best-seller", sales: "35K+", slug: "miroir-soleil-dore" },
  { name: "Bocaux Bambou Set de 6", emoji: "‚ú®", price: "36,99", asin: "B07YCPF9JX", tag: "Top cuisine", sales: "22K+", slug: "bocaux-conservation-verre" },
  { name: "Cache-Pot C√©ramique x3", emoji: "üåø", price: "28,99", asin: "B09ZT4BHLQ", tag: "Tendance", sales: "14K+", slug: "cache-pot-ceramique-blanc" },
  { name: "Tapis Berb√®re G√©o Noir/Blanc", emoji: "üß∂", price: "44,99", asin: "B08VKPC4TX", tag: "Incontournable", sales: "18K+", slug: "tapis-berbere-blanc" },
  { name: "Set SDB Noir Mat 6 pi√®ces", emoji: "üöø", price: "65,99", asin: "B09L5XTQNK", tag: "Luxe abordable", sales: "8K+", slug: "accessoires-bain-noir-mat" },
];
---

<BaseLayout
  title="Accueil"
  description={siteConfig.siteDescription}
>
  <!-- Hero Section - Optimis√© conversion -->
  <section class="relative bg-gradient-to-br from-primary-50 via-warm-50 to-accent-50 py-16 md:py-24 overflow-hidden">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto text-center">
        <!-- Badge social proof -->
        <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full shadow-sm mb-6">
          <span class="flex h-2 w-2 relative">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
          </span>
          <span class="text-sm text-gray-600 font-medium">Les produits les plus populaires de 2025</span>
        </div>

        <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 leading-tight mb-6">
          D√©corez votre maison
          <span class="text-primary-600"> sans vous ruiner</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-600 mb-8 max-w-2xl mx-auto leading-relaxed">
          Salut, je suis Issam. Je teste les produits d√©co Amazon pour vous, et je vous dis honn√™tement lesquels valent vraiment le coup. Que des avis vrais, aucun bullshit.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/produits/" class="btn-primary text-lg px-8 py-4">
            üî• Voir les best-sellers
          </a>
          <a href="/blog/" class="inline-flex items-center justify-center px-6 py-3 bg-white text-gray-700 font-semibold rounded-lg border border-gray-200 hover:border-primary-300 hover:text-primary-600 transition-all duration-200 shadow-sm">
            Lire nos guides
          </a>
        </div>

        <!-- Trust badges -->
        <div class="flex flex-wrap items-center justify-center gap-4 mt-8 text-sm">
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>‚úÖ</span><span class="text-gray-700 font-medium">Produits test√©s</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>üì¶</span><span class="text-gray-700 font-medium">Livraison Amazon rapide</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>‚≠ê</span><span class="text-gray-700 font-medium">Min. 4 √©toiles</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 px-3 py-2 rounded-lg border border-gray-100">
            <span>üí∞</span><span class="text-gray-700 font-medium">Petit budget</span>
          </div>
        </div>
      </div>
    </div>
    <div class="absolute top-10 left-10 text-6xl opacity-10">üè†</div>
    <div class="absolute bottom-10 right-10 text-6xl opacity-10">üõãÔ∏è</div>
  </section>

  <!-- üî• TRENDING Section - Tendances du moment -->
  <section class="py-14 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900">
    <div class="container-custom">
      <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between mb-10 gap-4">
        <div>
          <span class="inline-flex items-center gap-2 bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-sm font-bold mb-3">
            üî• TRENDING
          </span>
          <h2 class="font-serif text-3xl md:text-4xl font-bold text-white">
            Tendances du moment
          </h2>
          <p class="text-gray-400 mt-2 text-sm">S√©lection mise √† jour ‚Äî prix v√©rifi√©s sur Amazon.fr</p>
        </div>
        <a href="/produits/" class="text-primary-400 hover:text-primary-300 font-semibold text-sm flex items-center gap-1 whitespace-nowrap transition-colors">
          Voir tout ({allProducts.length} produits)
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {trendingProducts.map((product) => (
          <a
            href={`/produits/${product.slug}/`}
            class="bg-gray-800/60 border border-gray-700 rounded-2xl p-5 hover:border-amber-400/50 transition-all duration-300 hover:scale-[1.01] group block backdrop-blur-sm"
          >
            <div class="flex items-center justify-between mb-4">
              <span class="text-4xl">{product.emoji}</span>
              <span class="text-xs font-bold px-3 py-1 rounded-full bg-amber-400/20 text-amber-400 border border-amber-400/30">{product.tag}</span>
            </div>
            <h3 class="font-bold text-white group-hover:text-amber-400 transition-colors mb-1 text-lg">{product.name}</h3>
            <div class="flex items-center justify-between mt-4 pt-3 border-t border-gray-700">
              <span class="text-2xl font-bold text-amber-400">{product.price} ‚Ç¨</span>
              <div class="text-right">
                <span class="block text-xs text-gray-400">{product.sales} vendus</span>
                <span class="block text-xs text-green-400 font-medium mt-0.5">En stock ‚úì</span>
              </div>
            </div>
            <div class="mt-4 text-center bg-amber-400 text-gray-900 py-2 rounded-xl font-bold text-sm group-hover:bg-amber-300 transition-colors">
              Voir le produit ‚Üí
            </div>
          </a>
        ))}
      </div>

      <!-- Stats sociales proof -->
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-10 pt-10 border-t border-gray-700/50">
        <div class="text-center">
          <div class="text-3xl font-bold text-white">{allProducts.length}+</div>
          <div class="text-gray-400 text-sm">Produits test√©s</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-white">4,5‚òÖ</div>
          <div class="text-gray-400 text-sm">Note moyenne</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-white">100k+</div>
          <div class="text-gray-400 text-sm">Avis Amazon</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-white">24h</div>
          <div class="text-gray-400 text-sm">Livraison Prime</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Categories -->
  <section class="py-16">
    <div class="container-custom">
      <h2 class="font-serif text-3xl font-bold text-gray-900 text-center mb-3">
        Explorez par cat√©gorie
      </h2>
      <p class="text-gray-500 text-center mb-10 text-sm">Guides et produits tri√©s par pi√®ce et par th√®me</p>
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
        {categories.map((cat) => (
          <a
            href={`/produits/?cat=${cat.slug}`}
            class="card p-5 text-center hover:border-primary-200 hover:shadow-md group transition-all duration-200"
          >
            <span class="text-4xl mb-3 block">{cat.emoji}</span>
            <h3 class="font-semibold text-gray-900 group-hover:text-primary-600 transition-colors text-sm">{cat.name}</h3>
            <p class="text-xs text-gray-500 mt-1 hidden sm:block">{cat.description}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Products -->
  {featuredProducts.length > 0 && (
    <section class="py-16 bg-white">
      <div class="container-custom">
        <div class="flex items-center justify-between mb-10">
          <div>
            <h2 class="font-serif text-3xl font-bold text-gray-900">
              ‚≠ê Mes coups de c≈ìur
            </h2>
            <p class="text-gray-500 mt-1 text-sm">Produits que j'ai gard√©s apr√®s test ‚Äî recommand√©s √† 100%</p>
          </div>
          <a href="/produits/" class="text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1 whitespace-nowrap">
            Tout voir
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          {featuredProducts.map((product) => (
            <ProductCard
              name={product.data.name}
              slug={product.data.slug}
              shortDescription={product.data.shortDescription}
              image={product.data.image}
              category={product.data.category}
              price={product.data.price}
              rating={product.data.rating}
              featured={product.data.featured}
              bestseller={product.data.bestseller}
              inStock={product.data.inStock}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- üÜï Nouveaut√©s -->
  <section class="py-16 bg-gradient-to-br from-primary-50 to-warm-50">
    <div class="container-custom">
      <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between mb-10 gap-4">
        <div>
          <span class="inline-flex items-center gap-2 bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold mb-3">
            üÜï NOUVEAUT√âS
          </span>
          <h2 class="font-serif text-3xl md:text-4xl font-bold text-gray-900">
            Derniers produits ajout√©s
          </h2>
          <p class="text-gray-500 mt-2 text-sm">Fra√Æchement s√©lectionn√©s et test√©s pour vous</p>
        </div>
        <a href="/produits/" class="text-primary-600 hover:text-primary-700 font-semibold text-sm flex items-center gap-1 whitespace-nowrap">
          Voir tout le catalogue
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {allProducts.slice(0, 4).map((product) => (
          <ProductCard
            name={product.data.name}
            slug={product.data.slug}
            shortDescription={product.data.shortDescription}
            image={product.data.image}
            category={product.data.category}
            price={product.data.price}
            rating={product.data.rating}
            featured={product.data.featured}
            bestseller={product.data.bestseller}
            inStock={product.data.inStock}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Recent Blog Posts -->
  {recentPosts.length > 0 && (
    <section class="py-16">
      <div class="container-custom">
        <div class="flex items-center justify-between mb-10">
          <div>
            <h2 class="font-serif text-3xl font-bold text-gray-900">
              üìù Derniers guides
            </h2>
            <p class="text-gray-500 mt-1 text-sm">Conseils pratiques pour d√©corer intelligemment</p>
          </div>
          <a href="/blog/" class="text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1 whitespace-nowrap">
            Tous les articles
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recentPosts.map((post) => (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              cover={post.data.cover}
              coverAlt={post.data.coverAlt}
              category={post.data.category}
              type={post.data.type}
              pubDate={post.data.pubDate}
              slug={post.id}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Ebook CTA Banner -->
  <section class="py-12 bg-gradient-to-r from-purple-600 to-indigo-700">
    <div class="container-custom">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="text-center md:text-left">
          <span class="text-4xl mb-2 block">üìö</span>
          <h2 class="font-serif text-2xl md:text-3xl font-bold text-white mb-2">
            Ebook : 50 Astuces D√©co Petit Budget
          </h2>
          <p class="text-purple-200">Transformez votre int√©rieur pour moins de 50 ‚Ç¨ par pi√®ce</p>
        </div>
        <div class="text-center">
          <div class="mb-2">
            <span class="text-sm text-purple-300 line-through">19,99 ‚Ç¨</span>
            <span class="text-3xl font-bold text-white ml-2">9,99 ‚Ç¨</span>
          </div>
          <a href="/ebooks/" class="inline-flex items-center justify-center px-8 py-3 bg-white text-purple-700 font-bold rounded-lg hover:bg-gray-100 transition-colors shadow-lg">
            D√©couvrir ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section Social -->
  <section class="py-16 bg-gradient-to-r from-primary-500 to-primary-700">
    <div class="container-custom text-center">
      <h2 class="font-serif text-3xl md:text-4xl font-bold text-white mb-4">
        On se suit sur les r√©seaux ?
      </h2>
      <p class="text-primary-100 text-lg mb-8 max-w-2xl mx-auto">
        Je partage mes bons plans, hauls Amazon et astuces d√©co en vid√©o. Rejoins la communaut√© pour ne rien rater !
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href={siteConfig.social.tiktok} target="_blank" rel="noopener" class="inline-flex items-center justify-center px-6 py-3 bg-white text-gray-900 font-bold rounded-lg hover:bg-gray-100 transition-colors gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.27 6.27 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.75a8.18 8.18 0 004.76 1.52V6.84a4.83 4.83 0 01-1-.15z"/></svg>
          TikTok
        </a>
        <a href={siteConfig.social.youtube} target="_blank" rel="noopener" class="inline-flex items-center justify-center px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
          YouTube
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
