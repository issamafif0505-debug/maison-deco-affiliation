---
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/common/Breadcrumbs.astro';
import { formatDate } from '../utils/formatting';
import { articleSchema } from '../utils/seo';
import siteConfig from '../data/site-config.json';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  author: string;
  cover: string;
  coverAlt: string;
  category: string;
  tags: string[];
  type: string;
}

const { title, description, pubDate, updatedDate, author, cover, coverAlt, category, tags, type } = Astro.props;

const breadcrumbs = [
  { label: 'Blog', href: '/blog/' },
  { label: title },
];

const schema = articleSchema({
  title,
  description,
  image: cover,
  publishDate: pubDate,
  updatedDate,
  url: new URL(Astro.url.pathname, siteConfig.siteUrl).toString(),
});

const typeLabels: Record<string, string> = {
  'top-10': 'Top 10',
  'comparatif': 'Comparatif',
  'review': 'Review',
  'guide': 'Guide',
  'astuce': 'Astuce',
};

const typeColors: Record<string, string> = {
  'top-10': 'badge-viral',
  'comparatif': 'badge-type',
  'review': 'badge-category',
  'guide': 'badge-new',
  'astuce': 'badge-type',
};
---

<BaseLayout
  title={title}
  description={description}
  image={cover}
  type="article"
  publishDate={pubDate}
  schema={schema}
>
  <article class="container-custom py-8 md:py-12">
    <Breadcrumbs items={breadcrumbs} />

    <!-- Article Header -->
    <header class="max-w-3xl mx-auto mb-8">
      <div class="flex flex-wrap gap-2 mb-4">
        <span class="badge-category capitalize text-sm">{category}</span>
        <span class:list={[typeColors[type] || 'badge-type', 'text-sm']}>{typeLabels[type] || type}</span>
      </div>

      <h1 class="font-serif text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 leading-tight mb-5">
        {title}
      </h1>

      <p class="text-lg text-gray-600 mb-5 leading-relaxed">{description}</p>

      <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 pb-5 border-b border-gray-100">
        <div class="flex items-center gap-2">
          <div class="w-9 h-9 rounded-full bg-gradient-to-br from-primary-400 to-accent-500 flex items-center justify-center flex-shrink-0">
            <span class="text-white font-bold text-sm">{author.charAt(0)}</span>
          </div>
          <div>
            <span class="font-semibold text-gray-800 block leading-none">{author}</span>
            <span class="text-xs text-gray-400">Testeur & r√©dacteur</span>
          </div>
        </div>
        <span class="text-gray-200">|</span>
        <time datetime={pubDate.toISOString()} class="flex items-center gap-1">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          {formatDate(pubDate)}
        </time>
        {updatedDate && (
          <span class="flex items-center gap-1 text-green-600">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Mis √† jour le {formatDate(updatedDate)}
          </span>
        )}
      </div>
    </header>

    <!-- Cover Image -->
    <div class="max-w-4xl mx-auto mb-10">
      <img
        src={cover}
        alt={coverAlt}
        class="w-full h-56 md:h-80 lg:h-96 object-cover rounded-2xl shadow-lg"
        loading="eager"
        width="800"
        height="400"
      />
    </div>

    <!-- Layout article + sidebar -->
    <div class="max-w-3xl mx-auto">
      <!-- Article Content -->
      <div class="prose-custom mb-12">
        <slot />
      </div>

      <!-- Newsletter inline CTA (content-strategy skill) -->
      <div class="my-10 p-6 bg-gradient-to-r from-primary-50 to-accent-50 rounded-2xl border border-primary-100">
        <div class="flex flex-col sm:flex-row items-center gap-4">
          <div class="text-3xl flex-shrink-0">üì¨</div>
          <div class="flex-1 min-w-0">
            <h3 class="font-serif font-bold text-gray-900 mb-1">Re√ßois les meilleurs bons plans</h3>
            <p class="text-sm text-gray-600">Chaque semaine : produits test√©s + codes promo Amazon</p>
          </div>
          <form class="flex gap-2 w-full sm:w-auto flex-shrink-0" onsubmit="return false;">
            <input type="email" placeholder="ton@email.fr" class="input-newsletter flex-1 sm:w-48 text-sm py-2.5" />
            <button type="submit" class="btn-primary text-sm py-2.5 px-4 whitespace-nowrap">Je m'abonne</button>
          </form>
        </div>
      </div>

      <!-- Tags -->
      <div class="pt-6 border-t border-gray-100">
        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Mots-cl√©s</h3>
        <div class="flex flex-wrap gap-2">
          {tags.map((tag) => (
            <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs hover:bg-primary-50 hover:text-primary-700 transition-colors cursor-default">
              #{tag}
            </span>
          ))}
        </div>
      </div>

      <!-- Author Box ‚Äî Authority bias (marketing-psychology) -->
      <div class="mt-8 p-6 bg-white rounded-2xl border border-gray-100 shadow-sm">
        <div class="flex items-start gap-4">
          <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-400 to-accent-500 flex items-center justify-center flex-shrink-0">
            <span class="text-white font-bold text-xl">{author.charAt(0)}</span>
          </div>
          <div class="flex-1">
            <h3 class="font-serif font-bold text-gray-900 mb-1">√Ä propos de {author}</h3>
            <p class="text-sm text-gray-600 leading-relaxed mb-3">{siteConfig.author.bio}</p>
            <div class="flex flex-wrap gap-3">
              <a href={siteConfig.social.tiktok} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 text-xs font-medium text-gray-600 hover:text-gray-900 bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-lg transition-colors">
                TikTok @issam_deco
              </a>
              <a href={siteConfig.social.youtube} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 px-3 py-1.5 rounded-lg transition-colors">
                YouTube
              </a>
              <a href="/a-propos/" class="inline-flex items-center gap-1.5 text-xs font-medium text-primary-600 hover:text-primary-700 bg-primary-50 hover:bg-primary-100 px-3 py-1.5 rounded-lg transition-colors">
                En savoir plus ‚Üí
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Disclosure -->
      <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-100">
        <p class="text-xs text-gray-500 leading-relaxed">
          <strong>Transparence :</strong> Certains liens de cet article sont des liens d'affiliation Amazon.
          Si vous achetez via ces liens, je per√ßois une petite commission sans frais suppl√©mentaires pour vous.
          Cela me permet de continuer √† tester des produits gratuitement pour vous.
        </p>
      </div>
    </div>
  </article>
</BaseLayout>
