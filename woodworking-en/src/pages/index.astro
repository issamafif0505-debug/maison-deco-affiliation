---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { buildClickBankLink } from '../utils/affiliate';

const allProducts = await getCollection('products');
const featuredProducts = allProducts.filter(p => p.data.featured);

const stats = [
  { value: '16,000+', label: 'Woodworking Plans' },
  { value: '75%', label: 'Affiliate Commission' },
  { value: '$0', label: 'Budget to Start' },
  { value: '60-Day', label: 'Money-Back Guarantee' },
];
---

<BaseLayout title="Home" description="Honest reviews of the best DIY woodworking plans, shed blueprints, and home improvement programs. Build more, spend less.">

  <!-- Hero -->
  <section class="bg-gradient-to-br from-primary-700 via-primary-800 to-wood-900 text-white py-20 px-4">
    <div class="max-w-4xl mx-auto text-center">
      <div class="inline-flex items-center gap-2 bg-white/10 border border-white/20 px-4 py-1.5 rounded-full text-sm font-medium mb-6">
        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
        <span>Top ClickBank DIY Products â€” 75% Commission</span>
      </div>
      <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-6">
        Build It Yourself.<br>
        <span class="text-yellow-300">Save Thousands.</span>
      </h1>
      <p class="text-xl text-primary-100 mb-8 max-w-2xl mx-auto">
        Stop paying contractors. The best woodworking plans, shed blueprints, and DIY home improvement guides â€” reviewed honestly.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="/products/" class="inline-flex items-center justify-center gap-2 bg-yellow-400 text-gray-900 font-bold px-8 py-4 rounded-xl text-lg hover:bg-yellow-300 transition-colors shadow-lg">
          ðŸ”¥ See Top DIY Products
        </a>
        <a href="/blog/" class="inline-flex items-center justify-center gap-2 bg-white/10 border border-white/30 text-white font-semibold px-6 py-4 rounded-xl hover:bg-white/20 transition-colors">
          Read Free Guides â†’
        </a>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="bg-white border-b border-gray-100 py-8">
    <div class="max-w-4xl mx-auto px-4 grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
      {stats.map(stat => (
        <div>
          <div class="text-3xl font-bold text-primary-700">{stat.value}</div>
          <div class="text-sm text-gray-500 mt-1">{stat.label}</div>
        </div>
      ))}
    </div>
  </section>

  <!-- Featured Products -->
  <section class="py-16 px-4">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-3">Top DIY Products on ClickBank</h2>
        <p class="text-gray-500 text-lg">Proven converters â€” all paying 75% commission</p>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {featuredProducts.map(product => {
          const cbLink = buildClickBankLink(product.data.clickbankNickname, product.data.clickbankId);
          return (
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow flex flex-col">
              <!-- Hero icon -->
              <div class="bg-gradient-to-br from-primary-50 to-primary-100 p-8 text-center">
                <span class="text-6xl">{product.data.heroIcon}</span>
                {product.data.badge && (
                  <div class={`mt-3 inline-block px-3 py-1 rounded-full text-xs font-bold ${
                    product.data.badgeColor === 'gold' ? 'bg-yellow-100 text-yellow-800' :
                    product.data.badgeColor === 'blue' ? 'bg-blue-100 text-blue-800' :
                    product.data.badgeColor === 'purple' ? 'bg-purple-100 text-purple-800' :
                    product.data.badgeColor === 'orange' ? 'bg-orange-100 text-orange-800' :
                    'bg-green-100 text-green-800'
                  }`}>
                    {product.data.badge}
                  </div>
                )}
              </div>
              <div class="p-6 flex flex-col flex-1">
                <h3 class="font-bold text-lg text-gray-900 mb-2">{product.data.name}</h3>
                <p class="text-gray-500 text-sm leading-relaxed mb-4 flex-1">{product.data.shortDescription}</p>
                <!-- Commission info -->
                <div class="flex items-center justify-between text-sm mb-4">
                  <div class="flex items-center gap-1.5">
                    <span class="text-yellow-500">â˜…</span>
                    <span class="font-semibold">{product.data.rating.score}</span>
                    <span class="text-gray-400">({(product.data.rating.count / 1000).toFixed(1)}k reviews)</span>
                  </div>
                  <div class="bg-green-100 text-green-700 font-bold px-2.5 py-1 rounded-lg text-xs">
                    {product.data.commission.percentage}% COMMISSION
                  </div>
                </div>
                <div class="flex items-center justify-between mb-4">
                  <div>
                    <span class="text-2xl font-bold text-gray-900">${product.data.price.current}</span>
                    <span class="text-gray-400 text-sm ml-1">USD</span>
                  </div>
                  <div class="text-right text-xs text-gray-400">
                    <div>You earn: <span class="text-green-600 font-semibold">${product.data.commission.avgPerSale.toFixed(0)}</span></div>
                    <div>Gravity: <span class="font-semibold">{product.data.gravity}</span></div>
                  </div>
                </div>
                <div class="space-y-2">
                  <a href={cbLink} target="_blank" rel="noopener noreferrer nofollow" class="block w-full text-center bg-primary-600 text-white font-bold py-3 rounded-xl hover:bg-primary-700 transition-colors">
                    Get Affiliate Link â†’
                  </a>
                  <a href={`/products/${product.data.slug}/`} class="block w-full text-center bg-gray-100 text-gray-700 font-semibold py-2.5 rounded-xl hover:bg-gray-200 transition-colors text-sm">
                    Full Review
                  </a>
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Why DIY section -->
  <section class="bg-wood-50 py-16 px-4">
    <div class="max-w-4xl mx-auto text-center">
      <h2 class="text-3xl font-bold text-gray-900 mb-4">Why the DIY Niche Wins</h2>
      <p class="text-gray-600 mb-10 text-lg">These aren't trendy weight-loss pills that come and go. This is evergreen content that sells year after year.</p>
      <div class="grid md:grid-cols-3 gap-6">
        {[
          { icon: 'ðŸ”„', title: 'Evergreen Demand', desc: 'People always want to build things and save money. This niche never dies.' },
          { icon: 'ðŸ’°', title: '75% Commission', desc: 'One of the highest commission rates on ClickBank â€” $45â€“$75 per sale.' },
          { icon: 'ðŸ“Œ', title: 'Viral on Pinterest', desc: 'DIY content gets millions of saves. Free, passive traffic forever.' },
        ].map(item => (
          <div class="bg-white p-6 rounded-2xl shadow-sm text-center">
            <div class="text-4xl mb-3">{item.icon}</div>
            <h3 class="font-bold text-gray-900 mb-2">{item.title}</h3>
            <p class="text-gray-500 text-sm">{item.desc}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-16 px-4 text-center">
    <div class="max-w-2xl mx-auto">
      <h2 class="text-3xl font-bold text-gray-900 mb-4">Ready to Start Earning?</h2>
      <p class="text-gray-500 mb-8 text-lg">Browse all DIY products, get your affiliate links, and start promoting today.</p>
      <a href="/products/" class="inline-flex items-center gap-2 bg-primary-600 text-white font-bold px-8 py-4 rounded-xl text-lg hover:bg-primary-700 transition-colors shadow-lg">
        Browse All Products â†’
      </a>
    </div>
  </section>

</BaseLayout>
