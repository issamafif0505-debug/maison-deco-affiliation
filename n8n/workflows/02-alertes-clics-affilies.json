{
  "name": "02 - Alertes Clics Affili√©s Amazon (Webhook ‚Üí Telegram)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "affiliate-click",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-click",
      "name": "Webhook - Clic Affili√©",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300],
      "webhookId": "affiliate-click"
    },
    {
      "parameters": {
        "jsCode": "// Analyser le clic affili√©\nconst body = $input.first().json.body;\nconst timestamp = new Date().toLocaleString('fr-FR', { timeZone: 'Africa/Casablanca' });\n\nreturn [{\n  json: {\n    product: body.product || 'Produit inconnu',\n    asin: body.asin || 'N/A',\n    page: body.page || 'N/A',\n    price: body.price || 'N/A',\n    timestamp: timestamp,\n    userAgent: body.userAgent || 'N/A'\n  }\n}];\n"
      },
      "id": "parse-click",
      "name": "Analyser le clic",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "chatId": "={{ $vars.TELEGRAM_CHAT_ID }}",
        "text": "=üí∞ *Clic Affili√© Amazon !*\n\nüõçÔ∏è Produit : *{{ $json.product }}*\nüì¶ ASIN : `{{ $json.asin }}`\nüí∂ Prix : {{ $json.price }}‚Ç¨\nüìÑ Page source : {{ $json.page }}\nüïê Heure : {{ $json.timestamp }}\n\nüîó [Voir sur Amazon](https://www.amazon.fr/dp/{{ $json.asin }}?tag=issamdeco-21)",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-alert",
      "name": "Alerte Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [680, 300],
      "credentials": {
        "telegramApi": {
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"status\": \"ok\" }"
      },
      "id": "respond-webhook",
      "name": "R√©pondre OK",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [900, 300]
    }
  ],
  "connections": {
    "Webhook - Clic Affili√©": {
      "main": [[{ "node": "Analyser le clic", "type": "main", "index": 0 }]]
    },
    "Analyser le clic": {
      "main": [[{ "node": "Alerte Telegram", "type": "main", "index": 0 }]]
    },
    "Alerte Telegram": {
      "main": [[{ "node": "R√©pondre OK", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": ["affiliation", "monitoring", "telegram"]
}
